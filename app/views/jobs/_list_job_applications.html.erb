<% content_for :header_tags do %>
    <%= stylesheet_link_tag 'assets', :plugin => 'redmine_app_tracker' %>
<% end %>

<% unless @job_applications.nil? || @job_applications.empty? %>
    <p></p>
	<h3>Results - <%= @job_applications.length %></h3>
	
	<p>	
	  <% form_tag({ :action =>  :export_filtered_to_csv }, :html => { :multipart => true })do -%>
	    <%= hidden_field_tag :job_id, @job.id %>
		<% @job_applications.each do |ja| %>
	      <%= hidden_field_tag "job_app_ids[]", ja.id %>
	    <% end %>
	    <%= submit_tag "Export Filtered Results To CSV" -%>
	  <% end -%>
	</p>
	<p>
	  <%= button_to 'Zip Materials for Filtered Results Into Single Folder', zip_filtered_single_jobs_path(:job_id => @job.id, :job_applications => @job_applications) %>
	</p>
	<p>
	  <%= button_to 'Zip Materials for Filtered Results Into Folders by Applicant', zip_filtered_jobs_path(:job_id => @job.id, :job_applications => @job_applications) %>
	</p>
	<table id="list_table">
	  <thead class="list_table-first">
	    <tr>
		  <th style="text-align:left;"></th>
		  <% @columns.each do |column| %>
		    <th style="text-align:left;"><%= column %></th>
		  <% end %>
	    </tr>	
	  </thead>
	  <tbody>
		<% @job_applications.each do |ja| %>
		<tr>
		  <td><%= link_to "View", job_application_path(ja, :apptracker_id => @apptracker.id) %></td>	
		  
		    <% @applicant_fields.each do |af| %>
	          <td><%= ja.applicant.send(af) %></td>
	        <% end %>
		    <% @custom.each do |c| %>
			  <% ja.custom_values.each do |cv| %>
		        <% if cv.custom_field.name == c %>
		          <td><%= show_value(cv) %></td>
			    <% end %>
		      <% end %>
			<% end %>
			<% referrals = ja.job_application_referrals %>
    		<% referrals.each do |r| %>
      		  <% @referral_fields.each do |rf| %>
        	    <td><%= r.send(rf) %></td>
      		  <% end %>
    		<% end %>
			<% @statuses.each do |s| %>
		      <td><%= ja.send(s) %></td>
		    <% end %>
		    
		</tr>
		<% end %>
	  </tbody>
	</table>
<% else %>
  <p>No applications found.	</p>
<% end %>