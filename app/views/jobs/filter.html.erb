<% flash[:notice] %>
<h2><%=h @job.apptracker.title %>: Jobs: <em><%= link_to @job.title, job_path(@job) %></em></h2>

<% form_tag({:controller => 'jobs', :action => 'filter'}) do %>
  <% job_fields = @job_application_custom_fields.collect {|x| x.id} %>
  <%= hidden_field_tag :job_id, @job.id %>
  <% unless job_fields.nil? || job_fields.empty? %>
    <h3>Search Applications</h3>
    <% @job_application.custom_field_values.each do |value| %>
	  <% if job_fields.include? value.custom_field_id %>
		<p><%= custom_field_tag_with_label :filter, value %></p>
	  <% end %>
    <% end -%>
  <% end %>
  <%= submit_tag "Filter" -%>
<% end %>

<% unless @job_applications.nil? %>
	<p></p>
	<h3>Results</h3>
	<table class="list">
	  <thead>
	    <tr>
		  <th style="text-align:left;"></th>
		  <% @columns.each do |column| %>
		    <th style="text-align:left;"><%= column %></th>
		  <% end %>
	    </tr>	
	  </thead>
	  <tbody>
		<% @job_applications.each do |ja| %>
		<tr>
		  <td><%= link_to "View", job_application_path(ja) %></td>	
		  <% @applicant_fields.each do |af| %>
	        <td><%= ja.applicant.send(af) %></td>
	      <% end %>
		  <% @custom.each do |c| %>
		    <% ja.custom_values.each do |cv| %>
		      <% if cv.custom_field.name == c %>
		        <td><%= show_value(cv) %></td>
			  <% end %>
		    <% end %>
		  <% end %>
		</tr>
		<% end %>
	  </tbody>
	</table>
<% end %>