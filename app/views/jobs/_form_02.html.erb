<% form_for(@job, :html => {:multipart => true}) do |f| %>
  <%= f.error_messages %>
  <%= f.hidden_field(:apptracker_id, :value => @apptracker.id ) %>
  <%= hidden_field(:form, :form_id, :value => 2 ) %>
  <p>Part 2 of 2</p>
    Job Attachments<br /><br /> 

    <% @job.job_attachments.build() %>
    
    <% @job.attachment_count.times do |n|%>

      <% f.fields_for :job_attachments do |ja| %>

        <% #NOTE This is the code that is supposed to attach to Redmine's built-in Attachment model? %>
        <%= file_field_tag("attachments[#{n}][file]", :size => 30, :id => nil)-%><br />

        <%= ja.label(:notes, 'Notes/Description (Optional):') %><br />
        <%= ja.text_area(:notes, :size => "60x5") %><br />
        <small>
          <%= l(:label_max_size) %>: <%= number_to_human_size(Setting.attachment_max_size.to_i.kilobytes) %>
        </small>

        <!-- Provide opportunity to delete child records -->
        <% unless ja.object.new_record? %>
          <%= ja.label :_delete, 'Remove:' %>
          <%= ja.check_box :_delete %>
        <% end %>
      <% end %>

      <br /><br />

    <% end %>
    
    <p>
      <%= f.submit('Save') %>
    </p>
    
<% end %>

